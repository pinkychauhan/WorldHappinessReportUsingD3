<!DOCTYPE html>
<html>
<script src='https://d3js.org/d3.v5.min.js'></script>

<style>

  rect {
    stroke: grey;
  }
  .chart {
    opacity: 0;
    border: solid;
  }
  #tooltip {
    opacity: 0;
    position: absolute;
    text-align: left;
    width: auto;
    height: auto;
    background: white;
    border: 2 px;
  }
  fieldset {
    opacity: 0;
    position: relative;
    float: left;
    width: fit-content;
  }

</style>

<body onload='inithome()'>

  <button id = "home" onclick = "inithome()"> HOME </button>
  <button id = "2015" onClick = "init(2015)">2015</button>
  <button id = "2016" onClick = "init(2016)">2016</button>
  <button id = "2017" onClick = "init(2017)">2017</button>
  <button id = "2018" onClick = "init(2018)">2018</button>
  <button id = "2019" onClick = "init(2019)">2019</button>

  <div class = "homepage">
    HOMEPAGE
  </div>

  <svg class = "chart">
  </svg>

  <div id = "tooltip"></div>

  <div>
    <fieldset>
      <legend>Regions</legend>
      <div>
        <input type="radio" id="All" name="regions" value="All" checked onchange="displayChart()">
        <label for="coding">All</label>
      </div>
      <div>
        <input type="radio" id="Australia and New Zealand" name="regions" value="Australia and New Zealand" onchange="displayChart()">
        <label for="coding">Australia and New Zealand</label>
      </div>
      <div>
        <input type="radio" id="Central and Eastern Europe" name="regions" value="Central and Eastern Europe" onchange="displayChart()">
        <label for="music">Central and Eastern Europe</label>
      </div>
      <div>
        <input type="radio" id="Eastern Asia" name="regions" value="Eastern Asia" onchange="displayChart()">
        <label for="coding">Eastern Asia</label>
      </div>
      <div>
        <input type="radio" id="Latin America and Caribbean" name="regions" value="Latin America and Caribbean" onchange="displayChart()">
        <label for="music">Latin America and Caribbean</label>
      </div>
      <div>
        <input type="radio" id="Middle East and Northern Africa" name="regions" value="Middle East and Northern Africa" onchange="displayChart()">
        <label for="coding">Middle East and Northern Africa</label>
      </div>
      <div>
        <input type="radio" id="North America" name="regions" value="North America" onchange="displayChart()">
        <label for="music">North America</label>
      </div>
      <div>
        <input type="radio" id="Southeastern Asia" name="regions" value="Southeastern Asia" onchange="displayChart()">
        <label for="coding">Southeastern Asia</label>
      </div>
      <div>
        <input type="radio" id="Southern Asia" name="regions" value="Southern Asia" onchange="displayChart()">
        <label for="music">Southern Asia</label>
      </div>
      <div>
        <input type="radio" id="Sub-Saharan Africa" name="regions" value="Sub-Saharan Africa" onchange="displayChart()">
        <label for="music">Sub-Saharan Africa</label>
      </div>
      <div>
        <input type="radio" id="Western Europe" name="regions" value="Western Europe" onchange="displayChart()">
        <label for="coding">Western Europe</label>
      </div>
    </fieldset>

  </div>

<script>

const regionNames = ["Australia and New Zealand","Central and Eastern Europe", "Eastern Asia", "Latin America and Caribbean",
                  "Middle East and Northern Africa", "North America", "Southeastern Asia", "Southern Asia", "Sub-Saharan Africa",
                  "Western Europe"];

var data;

async function inithome() {
  console.log("HOMEPAGE");
  d3.selectAll("rect").remove();
  d3.select("#leftAxis").remove();
  d3.select("#bottomAxis").remove();
  d3.select(".chart").style("opacity", 0);
  document.getElementById("All").checked = true;
  d3.select("fieldset").style("opacity", 0);
  d3.select(".homepage").style("opacity", 1);


}

async function init(year) {
  url = "https://raw.githubusercontent.com/pinkychauhan89/cs498dataviz/master/data/" + year + ".csv";
  data = await d3.csv(url);
  displayChart();
}

 async function displayChart() {
   width = 1600;
   height = 600;
   margin = 50;

   d3.select(".homepage").style("opacity", 0);

   d3.selectAll("rect").remove();
   d3.select("#leftAxis").remove();
   d3.selectAll("#bottomAxis").remove();

   d3.select(".chart")
    .style("opacity", 1)
    .attr("width", width + (2 * margin))
    .attr("height", height + (2 * margin))

   d3.select("fieldset").style("opacity", 1)
   selectedRegions = getSelectedRegions();

   const maxHappinessScore = 10;
   const maxRank = data.length;

   var x = d3.scaleLinear().domain([0, maxRank]).range([0, width]);
   var y = d3.scaleLinear().domain([0, maxHappinessScore]).range([0, height]);
   var neg_y = d3.scaleLinear().domain([0, maxHappinessScore]).range([height, 0]);
   var color = d3.scaleLinear().domain([0, maxHappinessScore]).range(["red", "green"]);

   var tooltip = d3.select("#tooltip");


   d3.select(".chart")
     .append("g").attr("transform", "translate("+margin+","+margin+")")
     .selectAll("rect").data(data)
     .enter()
     .append("rect")
     .attr("x", function(d, i) { return  x(i) })
     .attr("y", function(d, i) { return 600 - y(d["HappinessScore"]) })
     .attr("width", 9)
     .attr("height", function(d, i) { return y(d["HappinessScore"]) })
     .style("fill", function(d, i) {
       var selected = false;
       var i;
       for (i = 0; i < selectedRegions.length; i++) {
         if (selectedRegions[i] === d.Region) {
           selected = true;
           break;
         }
       }
       if (selected) {
         return color(d["HappinessScore"])
       } else {
         return "white";
       }
     })
     .attr("class", function(d, i) {
       var selected = false;
       var i;
       for (i = 0; i < selectedRegions.length; i++) {
         if (selectedRegions[i] === d.Region) {
           selected = true;
           break;
         }
       }
       if (selected) {
         return "displayChartd"
       } else {
         return "notdisplayCharted";
       }
     })
     .on("mousemove", function(d, i) {
       tooltip
            .style("opacity", 1)
            .style("left", (d3.event.pageX) + "px")
            .style("top", (d3.event.pageY + 10) + "px")
            .html("Country: " + d["Country"] + "<br/>Region:" + d["Region"] + "<br/>Happiness Rank: " + d["HappinessRank"]
            + "<br/>Happiness Score: " + d["HappinessScore"] + "<br/>Economy (GDP per Capita):" + d["Economy"]
            + "<br/>Health (Life Expectancy): " + d["Health"]) })
      .on("mouseleave", function(d, i) {
        tooltip.style("opacity", 0)
      });


    d3.select(".chart")
       .append("g").attr("id","leftAxis").attr("transform", "translate("+margin+","+margin+")")
       .call(d3.axisLeft(neg_y));

    d3.select(".chart")
       .append("g").attr("id","bottomAxis").attr("transform", "translate("+margin+","+(height+margin)+")")
       .call(d3.axisBottom(x));

}

function getSelectedRegions() {

  var values = [];
  var regions = document.getElementsByName("regions");
  var i;
  for (i = 0; i < regions.length; i++) {
    if (regions[i].checked) {
      if (regions[i].value === 'All') {
        values = regionNames;
        break;
      }
      values.push(regions[i].value);
    }
  }
  return values;
}

</script>
</body>
</html>
